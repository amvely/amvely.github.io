<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MBTI í”„ë¡œëª¨ì…˜ 2026 â€” JíŒ€ vs PíŒ€</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.css">
<style>
:root{
  --bg:#09090f;--bg2:#0f1018;--bg3:#161820;
  --j:#5b9cf6;--j2:#2563eb;--jg:rgba(91,156,246,.28);--js:rgba(91,156,246,.08);
  --p:#fb923c;--p2:#ea580c;--pg:rgba(251,146,60,.28);--ps:rgba(251,146,60,.08);
  --win:#10b981;--lose:#f43f5e;--gold:#fbbf24;
  --text:#e2e8f0;--sub:#94a3b8;--muted:#64748b;
  --bd:rgba(255,255,255,.07);--bd2:rgba(255,255,255,.12);
}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--bg);color:var(--text);font-family:'Pretendard',-apple-system,sans-serif;min-height:100vh;font-size:14px;line-height:1.5;}
body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
  background-image:linear-gradient(rgba(91,156,246,.022) 1px,transparent 1px),linear-gradient(90deg,rgba(91,156,246,.022) 1px,transparent 1px);
  background-size:52px 52px;}
.wrap{position:relative;z-index:1;max-width:1180px;margin:0 auto;padding:32px 20px 90px;}
header{text-align:center;padding:40px 0 30px;animation:fadeDown .65s ease both;}
.promo-chip{display:inline-block;font-size:11px;font-weight:600;letter-spacing:3px;color:var(--muted);border:1px solid var(--bd2);padding:5px 18px;border-radius:99px;margin-bottom:16px;}
h1{font-size:clamp(28px,5vw,50px);font-weight:900;letter-spacing:-1px;line-height:1.05;background:linear-gradient(115deg,var(--j) 0%,#a78bfa 48%,var(--p) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.subtitle{margin-top:10px;color:var(--muted);font-size:13px;}
#loading{text-align:center;padding:100px 20px;color:var(--muted);}
.spin{display:inline-block;font-size:36px;animation:spin 1s linear infinite;margin-bottom:16px;}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-text{font-size:15px;font-weight:600;color:var(--sub);}
.loading-sub{font-size:12px;margin-top:6px;}
#error-msg{display:none;text-align:center;padding:60px 20px;}
.score-hero{display:grid;grid-template-columns:1fr 160px 1fr;background:var(--bg2);border:1px solid var(--bd);border-radius:22px;overflow:hidden;margin-bottom:20px;animation:fadeUp .55s .1s ease both;}
.score-side{padding:28px 30px 24px;display:flex;flex-direction:column;gap:5px;}
.score-side.j{background:linear-gradient(140deg,rgba(91,156,246,.13) 0%,transparent 60%);}
.score-side.p{background:linear-gradient(220deg,rgba(251,146,60,.13) 0%,transparent 60%);text-align:right;}
.s-lbl{font-size:10px;font-weight:700;letter-spacing:3px;color:var(--muted);text-transform:uppercase;}
.s-name{font-size:28px;font-weight:900;letter-spacing:-.5px;}
.score-side.j .s-name{color:var(--j);}
.score-side.p .s-name{color:var(--p);}
.s-wins{font-size:58px;font-weight:900;line-height:1;letter-spacing:-2px;}
.score-side.j .s-wins{color:var(--j);text-shadow:0 0 32px var(--jg);}
.score-side.p .s-wins{color:var(--p);text-shadow:0 0 32px var(--pg);}
.s-unit{font-size:16px;font-weight:600;vertical-align:super;}
.s-sub{font-size:12px;color:var(--muted);}
.s-need{font-size:12px;font-weight:600;color:var(--sub);}
.score-center{display:flex;flex-direction:column;align-items:center;justify-content:center;background:var(--bg3);gap:10px;padding:20px 12px;}
.vs-txt{font-size:16px;font-weight:900;color:rgba(255,255,255,.1);letter-spacing:4px;}
.target-chip{font-size:10px;font-weight:700;letter-spacing:1px;color:var(--gold);background:rgba(251,191,36,.1);border:1px solid rgba(251,191,36,.3);border-radius:99px;padding:3px 12px;}
.days-info{font-size:11px;color:var(--muted);text-align:center;line-height:1.8;font-weight:500;}
.race-wrap{background:var(--bg2);border:1px solid var(--bd);border-radius:18px;padding:22px 26px;margin-bottom:20px;animation:fadeUp .55s .17s ease both;}
.section-hd{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;}
.section-title{font-size:15px;font-weight:800;letter-spacing:-.3px;display:flex;align-items:center;gap:9px;}
.live-dot{width:8px;height:8px;border-radius:50%;background:var(--win);box-shadow:0 0 8px var(--win);animation:blink 1.4s ease infinite;}
.section-meta{font-size:11px;font-weight:600;color:var(--muted);}
.race-outer{position:relative;height:56px;background:var(--bg3);border-radius:12px;overflow:hidden;border:1px solid var(--bd);margin-bottom:8px;}
.race-outer::after{content:'ğŸ';position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);font-size:20px;opacity:.6;pointer-events:none;}
.finish-line{position:absolute;left:50%;top:0;bottom:0;width:2px;background:linear-gradient(180deg,transparent,var(--gold),transparent);opacity:.7;transform:translateX(-50%);}
.j-track{position:absolute;left:0;top:0;bottom:0;right:50%;overflow:hidden;}
.j-fill{position:absolute;left:0;top:0;bottom:0;background:linear-gradient(90deg,var(--j2),var(--j));border-radius:0 6px 6px 0;transition:width 1.6s cubic-bezier(.34,1.2,.64,1);}
.j-car{position:absolute;top:50%;transform:translateY(-50%);font-size:22px;transition:left 1.6s cubic-bezier(.34,1.2,.64,1);filter:drop-shadow(0 0 6px rgba(91,156,246,.8));animation:carBob .6s ease-in-out infinite;z-index:10;}
.p-track{position:absolute;right:0;top:0;bottom:0;left:50%;overflow:hidden;}
.p-fill{position:absolute;right:0;top:0;bottom:0;background:linear-gradient(270deg,var(--p2),var(--p));border-radius:6px 0 0 6px;transition:width 1.6s cubic-bezier(.34,1.2,.64,1);}
.p-car{position:absolute;top:50%;font-size:22px;transition:right 1.6s cubic-bezier(.34,1.2,.64,1);filter:drop-shadow(0 0 6px rgba(251,146,60,.8));animation:carBobR .7s ease-in-out infinite;animation-delay:.15s;z-index:10;}
.race-score-row{display:flex;justify-content:space-between;align-items:center;font-size:11px;font-weight:700;}
.rs-j{color:var(--j);}
.rs-p{color:var(--p);}
.rs-mid{color:var(--muted);font-size:10px;}
@keyframes carBob{0%,100%{transform:translateY(-50%)}50%{transform:translateY(calc(-50% - 3px))}}
@keyframes carBobR{0%,100%{transform:translateY(-50%) scaleX(-1)}50%{transform:translateY(calc(-50% - 3px)) scaleX(-1)}}
.weekly-wrap{background:var(--bg2);border:1px solid var(--bd);border-radius:18px;padding:22px 24px;margin-bottom:20px;animation:fadeUp .55s .23s ease both;}
.week-block{margin-bottom:18px;}
.week-block:last-child{margin-bottom:0;}
.week-label{font-size:11px;font-weight:700;letter-spacing:1px;color:var(--muted);text-transform:uppercase;margin-bottom:10px;display:flex;align-items:center;gap:8px;flex-wrap:wrap;}
.week-wins-summary{font-size:10px;font-weight:700;padding:2px 9px;border-radius:99px;}
.wws-j{background:var(--js);color:var(--j);border:1px solid rgba(91,156,246,.3);}
.wws-p{background:var(--ps);color:var(--p);border:1px solid rgba(251,146,60,.3);}
.wws-tie{background:rgba(255,255,255,.05);color:var(--muted);}
.week-days{display:grid;gap:8px;}
.day-card{background:var(--bg3);border-radius:12px;padding:12px 10px 10px;border:1px solid var(--bd);text-align:center;transition:transform .18s,box-shadow .18s;position:relative;overflow:hidden;}
.day-card:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,0,0,.3);}
.day-card.j-win{border-color:rgba(91,156,246,.35);background:linear-gradient(160deg,rgba(91,156,246,.08),var(--bg3));}
.day-card.p-win{border-color:rgba(251,146,60,.35);background:linear-gradient(160deg,rgba(251,146,60,.08),var(--bg3));}
.day-card.upcoming{opacity:.38;}
.day-card.today-card{border-color:var(--gold)!important;opacity:1;}
.day-date{font-size:11px;font-weight:700;color:var(--muted);margin-bottom:8px;}
.day-scores{display:flex;justify-content:center;align-items:center;gap:7px;margin-bottom:7px;}
.day-sc{font-size:14px;font-weight:800;}
.day-sc.j{color:var(--j);}
.day-sc.p{color:var(--p);}
.day-sep{color:var(--muted);font-size:11px;}
.day-badge{font-size:10px;font-weight:700;padding:2px 9px;border-radius:99px;display:inline-block;}
.day-badge.j{background:rgba(91,156,246,.15);color:var(--j);}
.day-badge.p{background:rgba(251,146,60,.15);color:var(--p);}
.day-badge.tbd{background:rgba(255,255,255,.05);color:var(--muted);}
.today-line{position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--gold),transparent);}

/* í™•ë¥  ì„¹ì…˜ */
.prob-wrap{background:var(--bg2);border:1px solid var(--bd);border-radius:18px;padding:22px 24px;margin-bottom:20px;animation:fadeUp .55s .29s ease both;}
.prob-cards{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:14px;}
.prob-card{background:var(--bg3);border-radius:14px;padding:20px 22px;border:1px solid var(--bd);text-align:center;}
.prob-team{font-size:18px;font-weight:900;margin-bottom:4px;}
.prob-card.j .prob-team{color:var(--j);}
.prob-card.p .prob-team{color:var(--p);}
.prob-pct{font-size:46px;font-weight:900;line-height:1;margin:8px 0 6px;letter-spacing:-2px;}
.prob-card.j .prob-pct{color:var(--j);text-shadow:0 0 24px var(--jg);}
.prob-card.p .prob-pct{color:var(--p);text-shadow:0 0 24px var(--pg);}
.prob-sub{font-size:11px;color:var(--muted);margin-bottom:12px;}
.gauge-bg{height:8px;background:rgba(255,255,255,.06);border-radius:99px;overflow:hidden;}
.gauge-fill{height:100%;border-radius:99px;transition:width 1.6s cubic-bezier(.4,0,.2,1);}
.prob-card.j .gauge-fill{background:linear-gradient(90deg,var(--j2),var(--j));}
.prob-card.p .gauge-fill{background:linear-gradient(90deg,var(--p2),var(--p));}

/* ì•Œê³ ë¦¬ì¦˜ ì„¤ëª… ë°•ìŠ¤ */
.algo-box{background:rgba(255,255,255,.025);border:1px solid var(--bd);border-radius:12px;padding:16px 18px;font-size:12px;color:var(--sub);line-height:1.9;}
.algo-title{font-size:10px;font-weight:700;color:var(--gold);letter-spacing:1.5px;margin-bottom:10px;}
.algo-factors{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px;}
.algo-factor{background:rgba(255,255,255,.03);border:1px solid var(--bd);border-radius:8px;padding:10px 12px;}
.af-label{font-size:10px;font-weight:700;color:var(--gold);margin-bottom:3px;}
.af-val{font-size:11px;color:var(--sub);}

/* ìš”ì¸ ìƒì„¸ */
.factor-detail{margin-top:12px;padding-top:12px;border-top:1px solid var(--bd);}
.factor-row{display:flex;justify-content:space-between;align-items:center;padding:5px 0;border-bottom:1px solid rgba(255,255,255,.03);}
.factor-name{font-size:11px;color:var(--muted);}
.factor-bars{display:flex;gap:6px;align-items:center;}
.factor-bar-j{height:6px;background:var(--j);border-radius:3px;min-width:2px;}
.factor-bar-p{height:6px;background:var(--p);border-radius:3px;min-width:2px;}
.factor-num-j{font-size:10px;font-weight:700;color:var(--j);min-width:36px;text-align:right;}
.factor-num-p{font-size:10px;font-weight:700;color:var(--p);min-width:36px;}

.stakes-row-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px;animation:fadeUp .55s .34s ease both;}
.stakes-card{background:var(--bg2);border-radius:18px;overflow:hidden;border:1px solid var(--bd);}
.stakes-hd{padding:15px 20px;display:flex;align-items:center;gap:12px;}
.stakes-card.exempt .stakes-hd{background:linear-gradient(90deg,rgba(16,185,129,.12),transparent);border-bottom:1px solid rgba(16,185,129,.2);}
.stakes-card.edu    .stakes-hd{background:linear-gradient(90deg,rgba(244,63,94,.12),transparent);border-bottom:1px solid rgba(244,63,94,.2);}
.stakes-icon{font-size:22px;}
.stakes-ttl{font-size:14px;font-weight:800;}
.stakes-card.exempt .stakes-ttl{color:var(--win);}
.stakes-card.edu    .stakes-ttl{color:var(--lose);}
.stakes-desc{font-size:11px;color:var(--muted);}
.stakes-body{padding:14px 16px 16px;}
.s-row{display:flex;align-items:center;gap:10px;padding:9px 12px;border-radius:10px;margin-bottom:6px;background:rgba(255,255,255,.025);border:1px solid var(--bd);}
.s-rank{width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:800;flex-shrink:0;}
.exempt .s-rank{background:rgba(16,185,129,.15);color:var(--win);}
.edu    .s-rank{background:rgba(244,63,94,.15);color:var(--lose);}
.s-name-st{font-size:13px;font-weight:600;flex:1;}
.s-team-chip{font-size:10px;padding:2px 8px;border-radius:99px;font-weight:700;}
.s-team-chip.j{background:var(--js);color:var(--j);}
.s-team-chip.p{background:var(--ps);color:var(--p);}
.s-transfer{font-size:12px;font-weight:800;}
.exempt .s-transfer{color:var(--win);}
.edu    .s-transfer{color:var(--lose);}
.s-note{font-size:11px;color:var(--muted);padding:6px 4px 0;line-height:1.7;}
.ind-wrap{background:var(--bg2);border:1px solid var(--bd);border-radius:18px;overflow:hidden;animation:fadeUp .55s .38s ease both;}
.ind-hd{padding:16px 24px;border-bottom:1px solid var(--bd);}
.t-scroll{overflow-x:auto;padding:0 16px 16px;}
table{width:100%;border-collapse:collapse;min-width:640px;}
thead th{padding:10px 12px;text-align:center;font-size:11px;font-weight:700;color:var(--muted);letter-spacing:.4px;border-bottom:1px solid var(--bd);white-space:nowrap;}
thead th:first-child{text-align:left;}
tbody tr{transition:background .15s;}
tbody tr:hover{background:rgba(255,255,255,.025);}
td{padding:9px 12px;text-align:center;border-bottom:1px solid rgba(255,255,255,.03);font-size:13px;font-weight:500;white-space:nowrap;}
td:first-child{text-align:left;font-weight:600;}
.group-hd-row td{padding:9px 14px;font-size:11px;font-weight:700;letter-spacing:.8px;border-top:2px solid var(--bd);border-bottom:1px solid var(--bd);}
.team-chip-sm{font-size:10px;padding:2px 9px;border-radius:99px;font-weight:700;}
.team-chip-sm.j{background:var(--js);color:var(--j);border:1px solid rgba(91,156,246,.25);}
.team-chip-sm.p{background:var(--ps);color:var(--p);border:1px solid rgba(251,146,60,.25);}
.rank-dot{display:inline-block;width:7px;height:7px;border-radius:50%;margin-right:7px;vertical-align:middle;}
.td-avg{font-size:12px;font-weight:800;}
.above-avg{color:var(--win);}
.below-avg{color:var(--lose);}
.cell-hi{color:var(--win);font-weight:700;}
.cell-z{color:var(--muted);}
.cell-null{color:rgba(255,255,255,.15);}
.tag-exempt{font-size:9px;font-weight:700;background:rgba(16,185,129,.12);color:var(--win);border:1px solid rgba(16,185,129,.3);border-radius:5px;padding:1px 5px;margin-left:4px;vertical-align:middle;}
.tag-edu{font-size:9px;font-weight:700;background:rgba(244,63,94,.12);color:var(--lose);border:1px solid rgba(244,63,94,.3);border-radius:5px;padding:1px 5px;margin-left:4px;vertical-align:middle;}
.td-transfer{font-size:11px;font-weight:700;color:var(--gold);}
.td-transfer-zero{font-size:11px;color:var(--muted);}
.update-badge{position:fixed;bottom:20px;right:20px;z-index:100;background:var(--bg2);border:1px solid var(--bd2);border-radius:12px;padding:8px 14px;font-size:11px;color:var(--muted);display:none;align-items:center;gap:8px;box-shadow:0 4px 20px rgba(0,0,0,.4);cursor:pointer;}
.update-badge:hover{border-color:var(--j);color:var(--text);}
.update-dot{width:6px;height:6px;border-radius:50%;background:var(--win);box-shadow:0 0 6px var(--win);}
@keyframes fadeDown{from{opacity:0;transform:translateY(-16px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.2}}
@media(max-width:720px){.score-hero{grid-template-columns:1fr 100px 1fr;}.s-wins{font-size:44px;}.prob-cards{grid-template-columns:1fr;}.stakes-row-grid{grid-template-columns:1fr;}.algo-factors{grid-template-columns:1fr;}}
@media(max-width:480px){.score-center{display:none;}.score-hero{grid-template-columns:1fr 1fr;}}
</style>
</head>
<body>
<div class="wrap">
<header>
  <div class="promo-chip">MBTI PROMOTION 2026</div>
  <h1>JíŒ€ vs PíŒ€</h1>
  <div class="subtitle">2026.02.23 ì‹œì‘ Â· í‰ì¼ ì´ 27ì¼ Â· ë¨¼ì € 15ìŠ¹ ë‹¬ì„± íŒ€ì´ ìµœì¢… ìŠ¹ë¦¬</div>
</header>

<div id="loading">
  <div class="spin">â³</div>
  <div class="loading-text">Google Sheets ì‹¤ì‹œê°„ ë°ì´í„° ë¡œë”© ì¤‘...</div>
  <div class="loading-sub">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</div>
</div>

<div id="error-msg">
  <div style="font-size:36px;margin-bottom:12px">âš ï¸</div>
  <div style="font-size:16px;font-weight:700;color:var(--lose);margin-bottom:8px">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>
  <div style="font-size:13px;color:var(--muted)" id="error-detail"></div>
  <div style="margin-top:16px;font-size:12px;color:var(--muted)">êµ¬ê¸€ ì‹œíŠ¸ê°€ <b>ì›¹ì— ê²Œì‹œ</b>ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”</div>
</div>

<div id="dashboard" style="display:none">
  <div class="score-hero">
    <div class="score-side j">
      <div class="s-lbl">Team J</div>
      <div class="s-name">JíŒ€</div>
      <div class="s-wins" id="j-wins">â€”</div>
      <div class="s-sub">í˜„ì¬ ìŠ¹ìˆ˜</div>
      <div class="s-need" id="j-need"></div>
    </div>
    <div class="score-center">
      <div class="vs-txt">VS</div>
      <div class="target-chip">ğŸ† ëª©í‘œ 15ìŠ¹</div>
      <div class="days-info" id="days-info"></div>
    </div>
    <div class="score-side p">
      <div class="s-lbl">Team P</div>
      <div class="s-name">PíŒ€</div>
      <div class="s-wins" id="p-wins">â€”</div>
      <div class="s-sub">í˜„ì¬ ìŠ¹ìˆ˜</div>
      <div class="s-need" id="p-need"></div>
    </div>
  </div>

  <div class="race-wrap">
    <div class="section-hd">
      <div class="section-title"><span class="live-dot"></span> 15ìŠ¹ ë ˆì´ìŠ¤</div>
      <div class="section-meta" id="race-meta"></div>
    </div>
    <div class="race-outer">
      <div class="finish-line"></div>
      <div class="j-track"><div class="j-fill" id="j-fill" style="width:0%"></div></div>
      <div class="j-car" id="j-car" style="left:4px">ğŸš™</div>
      <div class="p-track"><div class="p-fill" id="p-fill" style="width:0%"></div></div>
      <div class="p-car" id="p-car" style="right:4px">ğŸš•</div>
    </div>
    <div class="race-score-row">
      <span class="rs-j" id="race-j-label"></span>
      <span class="rs-mid">ğŸ 15ìŠ¹ ê²°ìŠ¹ì„ </span>
      <span class="rs-p" id="race-p-label"></span>
    </div>
  </div>

  <div class="weekly-wrap">
    <div class="section-hd">
      <div class="section-title"><span style="font-size:16px">ğŸ“…</span> ì£¼ì°¨ë³„ ì¼ë³„ ìŠ¹íŒ¨</div>
      <div class="section-meta" id="week-meta"></div>
    </div>
    <div id="weeks-container"></div>
  </div>

  <div class="prob-wrap">
    <div class="section-hd" style="margin-bottom:16px">
      <div class="section-title"><span style="font-size:15px">ğŸ²</span> ì‹¤ì‹œê°„ ìµœì¢… ìš°ìŠ¹ í™•ë¥ </div>
    </div>
    <div class="prob-cards">
      <div class="prob-card j">
        <div class="prob-team">JíŒ€</div>
        <div class="prob-pct" id="j-prob">â€”</div>
        <div class="prob-sub">ìµœì¢… ìš°ìŠ¹ í™•ë¥ </div>
        <div class="gauge-bg"><div class="gauge-fill" id="j-gauge" style="width:0%"></div></div>
      </div>
      <div class="prob-card p">
        <div class="prob-team">PíŒ€</div>
        <div class="prob-pct" id="p-prob">â€”</div>
        <div class="prob-sub">ìµœì¢… ìš°ìŠ¹ í™•ë¥ </div>
        <div class="gauge-bg"><div class="gauge-fill" id="p-gauge" style="width:0%"></div></div>
      </div>
    </div>
    <div class="algo-box">
      <div class="algo-title">ğŸ“ ì•Œê³ ë¦¬ì¦˜ â€” 4ìš”ì¸ ê°€ì¤‘ Monte Carlo Simulation</div>
      <div class="algo-factors" id="algo-factors">
        <!-- JSë¡œ ì±„ì›€ -->
      </div>
      <div id="factor-detail-container"></div>
      <div style="margin-top:10px;font-size:11px;color:var(--muted);line-height:1.8;">
        â‘  <b>ì „ì²´ ì ìˆ˜ ê¸°ë°˜ ê¸°ë³¸í™•ë¥ </b>: ì „ì²´ í‰ê·  ì¼ë³„ ì ìˆ˜ì°¨ë¥¼ ë¡œì§€ìŠ¤í‹± í•¨ìˆ˜ë¡œ ë³€í™˜<br>
        â‘¡ <b>ìµœê·¼ 3ê²½ê¸° ëª¨ë©˜í…€</b>: ìµœê·¼ 3ì¼ ê²°ê³¼ì— ì§€ìˆ˜ ê°€ì¤‘ì¹˜ ë¶€ì—¬ (ìµœì‹ ì¼ ê°€ì¤‘ì¹˜ 2ë°°)<br>
        â‘¢ <b>íŒ€ ì¼ê´€ì„± ì§€ìˆ˜</b>: ì ìˆ˜ ë¶„ì‚°ì´ ë‚®ì„ìˆ˜ë¡ ì•ˆì •ì  â†’ ìŠ¹ë¥  ê°€ì‚°<br>
        â‘£ <b>ì´ê´€ë§¤ì¶œ ë°˜ì˜</b>: íŒ€ ëˆ„ì  ì´ê´€ë§¤ì¶œ ë¹„ìœ¨ë¡œ ì—­ëŸ‰ ë³´ì •<br>
        ìµœì¢… p = 0.35Ã—pâ‚ + 0.35Ã—pâ‚‚_ëª¨ë©˜í…€ + 0.15Ã—pâ‚ƒ_ì¼ê´€ì„± + 0.15Ã—pâ‚„_ì´ê´€ë§¤ì¶œ<br>
        â†’ ë‚¨ì€ í‰ì¼ ê¸°ì¤€ <b>50,000íšŒ Monte Carlo ì‹œë®¬ë ˆì´ì…˜</b> â†’ ë¨¼ì € 15ìŠ¹ ë„ë‹¬ í™•ë¥  ì‚°ì¶œ
      </div>
    </div>
  </div>

  <div class="stakes-row-grid">
    <div class="stakes-card exempt">
      <div class="stakes-hd">
        <div class="stakes-icon">ğŸ†</div>
        <div>
          <div class="stakes-ttl">ë‹¤ìŒ í”„ë¡œëª¨ì…˜ ë©´ì œ</div>
          <div class="stakes-desc">ìŠ¹ë¦¬íŒ€ ì´ê´€ë§¤ì¶œ ìƒìœ„ 2ì¸ (ì¸í„´ ì œì™¸)</div>
        </div>
      </div>
      <div class="stakes-body" id="exempt-body"></div>
    </div>
    <div class="stakes-card edu">
      <div class="stakes-hd">
        <div class="stakes-icon">ğŸ“š</div>
        <div>
          <div class="stakes-ttl">ë ˆí¼ëŸ°ìŠ¤ êµìœ¡</div>
          <div class="stakes-desc">íŒ¨ë°°íŒ€ ì´ê´€ë§¤ì¶œ í•˜ìœ„ 2ì¸ (ì¸í„´ ì œì™¸)</div>
        </div>
      </div>
      <div class="stakes-body" id="edu-body"></div>
    </div>
  </div>

  <div class="ind-wrap">
    <div class="ind-hd">
      <div class="section-title" style="margin:0">
        <span style="font-size:15px">ğŸ“Š</span> ì „ì²´ ê°œì¸ ì ìˆ˜ í˜„í™©
        <span style="font-size:12px;font-weight:500;color:var(--muted);margin-left:4px">â­ ìƒëŒ€íŒ€ í‰ê·  ìƒíšŒ &nbsp;ğŸ’ª ìƒëŒ€íŒ€ í‰ê·  ë¯¸ë‹¬</span>
      </div>
    </div>
    <div class="t-scroll"><table id="main-table"></table></div>
  </div>
</div>
</div><!-- /wrap -->

<div class="update-badge" id="update-badge" onclick="loadData()" title="í´ë¦­í•˜ë©´ ìƒˆë¡œê³ ì¹¨">
  <div class="update-dot"></div>
  <span id="update-time"></span> &nbsp;ğŸ”„
</div>

<script>
/* â•â•â•â•â•â• CONFIG â•â•â•â•â•â• */
const CSV_URL     = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQwLn1ITezcGkfgKkd_B9_MwrTbllcubuHp1FpPjoucTMc7j0P4Ek6XBfvmYn_eHrhFc2-6KtuTOBR9/pub?gid=0&single=true&output=csv';
const TARGET      = 15;
const TOTAL_WD    = 27;
const INTERN_RANK = 'ì¸í„´';

const WEEK_SCHEDULE = [
  { label:'1ì£¼ì°¨', dates:['02ì›” 23ì¼','02ì›” 24ì¼','02ì›” 25ì¼','02ì›” 26ì¼','02ì›” 27ì¼'] },
  { label:'2ì£¼ì°¨', dates:['03ì›” 02ì¼','03ì›” 03ì¼','03ì›” 04ì¼','03ì›” 05ì¼','03ì›” 06ì¼'] },
  { label:'3ì£¼ì°¨', dates:['03ì›” 09ì¼','03ì›” 10ì¼','03ì›” 11ì¼','03ì›” 12ì¼','03ì›” 13ì¼'] },
  { label:'4ì£¼ì°¨', dates:['03ì›” 16ì¼','03ì›” 17ì¼','03ì›” 18ì¼','03ì›” 19ì¼','03ì›” 20ì¼'] },
  { label:'5ì£¼ì°¨', dates:['03ì›” 23ì¼','03ì›” 24ì¼','03ì›” 25ì¼','03ì›” 26ì¼','03ì›” 27ì¼'] },
  { label:'6ì£¼ì°¨', dates:['03ì›” 30ì¼','03ì›” 31ì¼'] },
];

/* â•â•â•â•â•â• CSV PARSER â•â•â•â•â•â• */
function parseCSV(text) {
  return text.replace(/\r/g,'').split('\n').map(line => {
    const cells=[]; let cur='', inQ=false;
    for(const ch of line){
      if(ch==='"'){inQ=!inQ;}
      else if(ch===','&&!inQ){cells.push(cur.trim());cur='';}
      else cur+=ch;
    }
    cells.push(cur.trim());
    return cells;
  });
}

const isDate = s => /\d+ì›”\s*\d+ì¼/.test((s||'').trim());
const toNum  = s => { const v=parseFloat((s||'').replace(/[^0-9.-]/g,'')); return isNaN(v)?0:v; };
const fix2   = v => Math.round(v*100)/100;
const avgArr = a => a.length ? a.reduce((s,v)=>s+v,0)/a.length : 0;
const shortD = d => d.replace(/0?(\d+)ì›”\s*0?(\d+)ì¼/,'$1/$2');

/* â•â•â•â•â•â• DATA PARSER â•â•â•â•â•â• */
function parseData(rows) {
  let section=null, dateHeaders=[];
  const jTeam=[], pTeam=[];

  for(const row of rows){
    const c=row.map(s=>(s||'').trim());
    if(c[1]==='JíŒ€'&&c[3]==='í‰ê· '){section='jScore';dateHeaders=row.slice(4).map(s=>s.trim()).filter(isDate);continue;}
    if(c[1]==='PíŒ€'&&c[3]==='í‰ê· '){section='pScore';continue;}
    if(c[1]==='JíŒ€'&&c[2]==='ì´ê´€ë§¤ì¶œ'&&isDate(c[3])){section='jTransfer';continue;}
    if(c[1]==='PíŒ€'&&c[2]==='ì´ê´€ë§¤ì¶œ'&&isDate(c[3])){section='pTransfer';continue;}
    if(!c[0]||!c[1]||c[1]==='ì¼í‰ê· ')continue;

    const rank=c[0], name=c[1];
    if(section==='jScore'||section==='pScore'){
      const m={rank,name,isIntern:rank===INTERN_RANK,transfer:toNum(c[2]),avg:toNum(c[3]),
        scores:dateHeaders.map((_,i)=>{const r=(row[4+i]||'').trim();return r===''?null:toNum(r);}),
        dailyTransfer:new Array(dateHeaders.length).fill(0)};
      section==='jScore'?jTeam.push(m):pTeam.push(m);
    }
    else if(section==='jTransfer'){
      const m=jTeam.find(x=>x.name===name);
      if(m){m.transfer=toNum(c[2]);m.dailyTransfer=dateHeaders.map((_,i)=>toNum((row[3+i]||'').trim()));}
    }
    else if(section==='pTransfer'){
      const m=pTeam.find(x=>x.name===name);
      if(m){m.transfer=toNum(c[2]);m.dailyTransfer=dateHeaders.map((_,i)=>toNum((row[3+i]||'').trim()));}
    }
  }
  return {dateHeaders,jTeam,pTeam};
}

/* â•â•â•â•â•â• í•µì‹¬: 4ìš”ì¸ ê°€ì¤‘ í™•ë¥  ê³„ì‚° â•â•â•â•â•â• */
function computeWinProbability(playedDates, dayResults, jWins, pWins, remaining, jTeam, pTeam) {
  if (!playedDates.length) return { p: 0.5, factors: null };

  const margins = playedDates.map(d => dayResults[d].j - dayResults[d].p);

  /* â”€â”€ ìš”ì¸ 1: ì „ì²´ í‰ê·  ì ìˆ˜ì°¨ ê¸°ë°˜ ê¸°ë³¸ í™•ë¥  â”€â”€
     í‰ê·  ë§ˆì§„ì„ ë¡œì§€ìŠ¤í‹± í•¨ìˆ˜ë¡œ ë³€í™˜. ìŠ¤ì¼€ì¼ 0.15ëŠ” ì‹¤ì œ ì ìˆ˜ ë²”ìœ„ì— ë”°ë¼ ì¡°ì • ê°€ëŠ¥ */
  const avgMargin = avgArr(margins);
  const p1 = 1 / (1 + Math.exp(-0.15 * avgMargin));

  /* â”€â”€ ìš”ì¸ 2: ìµœê·¼ 3ê²½ê¸° ì§€ìˆ˜ ê°€ì¤‘ ëª¨ë©˜í…€ â”€â”€
     ìµœì‹ ì¼ì— ë†’ì€ ê°€ì¤‘ì¹˜: [1, 1.5, 2.0] (ì˜¤ë˜ëœ â†’ ìµœì‹  ìˆœ) */
  let recentP2 = 0.5;
  if (playedDates.length >= 1) {
    const recentN = Math.min(3, playedDates.length);
    const weights = [1, 1.5, 2.0].slice(3 - recentN);
    const totalW = weights.reduce((s, w) => s + w, 0);
    let weightedJ = 0;
    for (let i = 0; i < recentN; i++) {
      const d = playedDates[playedDates.length - recentN + i];
      const w = weights[i];
      weightedJ += (dayResults[d].winner === 'j' ? 1 : 0) * w;
    }
    recentP2 = weightedJ / totalW;
  }

  /* â”€â”€ ìš”ì¸ 3: íŒ€ ì¼ê´€ì„± ì§€ìˆ˜ â”€â”€
     ì ìˆ˜ ë¶„ì‚°ì´ ë‚®ì„ìˆ˜ë¡ ì•ˆì •ì . ë¶„ì‚° ì—­ìˆ˜ ë¹„ìœ¨ë¡œ JíŒ€ ìœ ë¦¬ë„ ê³„ì‚° */
  const getTeamVariance = (team, dateIdx) => {
    const vals = team.map(m => m.scores[dateIdx]).filter(v => v !== null);
    if (vals.length < 2) return 1;
    const avg = avgArr(vals);
    return avgArr(vals.map(v => (v - avg) ** 2));
  };

  let jTotalVar = 0, pTotalVar = 0;
  playedDates.forEach((d, i) => {
    const idx = i; // ì‹¤ì œë¡œëŠ” dateHeaders ì¸ë±ìŠ¤ ë§¤í•‘ í•„ìš”í•˜ì§€ë§Œ ìˆœì„œê°€ ë™ì¼í•˜ë¯€ë¡œ ok
    jTotalVar += getTeamVariance(jTeam, idx);
    pTotalVar += getTeamVariance(pTeam, idx);
  });
  const jAvgVar = jTotalVar / playedDates.length + 0.001; // 0 ë°©ì§€
  const pAvgVar = pTotalVar / playedDates.length + 0.001;
  // J ë¶„ì‚°ì´ ë‚®ì„ìˆ˜ë¡ p3 > 0.5
  const p3 = pAvgVar / (jAvgVar + pAvgVar);

  /* â”€â”€ ìš”ì¸ 4: ì´ê´€ë§¤ì¶œ ì—­ëŸ‰ ë¹„ìœ¨ â”€â”€
     íŒ€ ì „ì²´ ì´ê´€ë§¤ì¶œ í•©ì‚° ë¹„ìœ¨ (ì¸í„´ ì œì™¸) */
  const jTransferSum = jTeam.filter(m => !m.isIntern).reduce((s, m) => s + m.transfer, 0);
  const pTransferSum = pTeam.filter(m => !m.isIntern).reduce((s, m) => s + m.transfer, 0);
  let p4 = 0.5;
  if (jTransferSum + pTransferSum > 0) {
    p4 = jTransferSum / (jTransferSum + pTransferSum);
  }

  /* â”€â”€ ìµœì¢… ê°€ì¤‘ í˜¼í•© â”€â”€ */
  const w1 = 0.35, w2 = 0.35, w3 = 0.15, w4 = 0.15;
  const p = w1 * p1 + w2 * recentP2 + w3 * p3 + w4 * p4;

  /* â”€â”€ Monte Carlo: 50,000íšŒ â”€â”€ */
  let jFinal = 0;
  for (let s = 0; s < 50000; s++) {
    let jW = jWins, pW = pWins, r = remaining;
    while (r > 0 && jW < TARGET && pW < TARGET) {
      Math.random() < p ? jW++ : pW++;
      r--;
    }
    if (jW >= TARGET) jFinal++;
  }
  const jProb = jFinal / 50000;

  return {
    p: jProb,
    factors: {
      p1: fix2(p1 * 100),
      p2: fix2(recentP2 * 100),
      p3: fix2(p3 * 100),
      p4: fix2(p4 * 100),
      avgMargin: fix2(avgMargin),
      jVar: fix2(jAvgVar),
      pVar: fix2(pAvgVar),
      jTransfer: jTransferSum,
      pTransfer: pTransferSum,
    }
  };
}

/* â•â•â•â•â•â• RENDER â•â•â•â•â•â• */
function render({dateHeaders,jTeam,pTeam}){
  const dayAvg=(team,i)=>{const v=team.map(m=>m.scores[i]).filter(v=>v!==null);return v.length?fix2(avgArr(v)):null;};
  const dayResults={};
  dateHeaders.forEach((d,i)=>{
    const jA=dayAvg(jTeam,i),pA=dayAvg(pTeam,i);
    if(jA===null&&pA===null)return;
    dayResults[d]={j:jA??0,p:pA??0,winner:(jA??0)>=(pA??0)?'j':'p'};
  });
  const playedDates=dateHeaders.filter(d=>dayResults[d]);
  const jWins=playedDates.filter(d=>dayResults[d].winner==='j').length;
  const pWins=playedDates.filter(d=>dayResults[d].winner==='p').length;
  const played=playedDates.length, remaining=TOTAL_WD-played;
  const jTeamAvg=fix2(avgArr(jTeam.map(m=>m.avg)));
  const pTeamAvg=fix2(avgArr(pTeam.map(m=>m.avg)));
  const now=new Date();
  const todayLabel=`${String(now.getMonth()+1).padStart(2,'0')}ì›” ${String(now.getDate()).padStart(2,'0')}ì¼`;

  // Score Hero
  document.getElementById('j-wins').innerHTML=`${jWins}<span class="s-unit">ìŠ¹</span>`;
  document.getElementById('p-wins').innerHTML=`${pWins}<span class="s-unit">ìŠ¹</span>`;
  document.getElementById('j-need').textContent=`15ìŠ¹ê¹Œì§€ ${TARGET-jWins}ìŠ¹ í•„ìš”`;
  document.getElementById('p-need').textContent=`15ìŠ¹ê¹Œì§€ ${TARGET-pWins}ìŠ¹ í•„ìš”`;
  document.getElementById('days-info').innerHTML=`${played}ì¼ ì§„í–‰<br>${remaining}ì¼ ë‚¨ìŒ`;

  // Race Bar
  document.getElementById('race-meta').textContent=`${played}ì¼ ê²½ê³¼ Â· ${remaining}ì¼ ë‚¨ìŒ`;
  document.getElementById('race-j-label').textContent=`â† JíŒ€ ${jWins}ìŠ¹`;
  document.getElementById('race-p-label').textContent=`PíŒ€ ${pWins}ìŠ¹ â†’`;
  setTimeout(()=>{
    const jP=Math.min((jWins/TARGET)*100,100), pP=Math.min((pWins/TARGET)*100,100);
    document.getElementById('j-fill').style.width=jP+'%';
    document.getElementById('p-fill').style.width=pP+'%';
    const jTW=document.querySelector('.j-track').offsetWidth, pTW=document.querySelector('.p-track').offsetWidth;
    document.getElementById('j-car').style.left=Math.max(4,4+(jP/100)*(jTW-40))+'px';
    document.getElementById('p-car').style.right=Math.max(4,4+(pP/100)*(pTW-40))+'px';
  },400);

  // Weekly
  const wCont=document.getElementById('weeks-container'); wCont.innerHTML='';
  let totalJ=0,totalP=0;
  WEEK_SCHEDULE.forEach(wk=>{
    let wJ=0,wP=0;
    wk.dates.forEach(d=>{if(dayResults[d])dayResults[d].winner==='j'?wJ++:wP++;});
    totalJ+=wJ;totalP+=wP;
    const hasData=wk.dates.some(d=>dayResults[d]);
    const sum=hasData?(wJ>wP?`<span class="week-wins-summary wws-j">J ${wJ}ìŠ¹ Â· P ${wP}ìŠ¹</span>`:wP>wJ?`<span class="week-wins-summary wws-p">J ${wJ}ìŠ¹ Â· P ${wP}ìŠ¹</span>`:`<span class="week-wins-summary wws-tie">J ${wJ}ìŠ¹ Â· P ${wP}ìŠ¹</span>`):`<span class="week-wins-summary wws-tie">ì˜ˆì •</span>`;
    const block=document.createElement('div'); block.className='week-block';
    block.innerHTML=`<div class="week-label">${wk.label} &nbsp;(${shortD(wk.dates[0])}~${shortD(wk.dates[wk.dates.length-1])}) ${sum}</div>`;
    const dDiv=document.createElement('div'); dDiv.className='week-days';
    dDiv.style.gridTemplateColumns=`repeat(${wk.dates.length},1fr)`;
    wk.dates.forEach(d=>{
      const res=dayResults[d], isT=d===todayLabel, card=document.createElement('div');
      if(res){
        card.className=`day-card ${res.winner}-win${isT?' today-card':''}`;
        card.innerHTML=`${isT?'<div class="today-line"></div>':''}<div class="day-date">${shortD(d)}${isT?' ğŸ”´':''}</div><div class="day-scores"><span class="day-sc j">${res.j}</span><span class="day-sep">:</span><span class="day-sc p">${res.p}</span></div><div class="day-badge ${res.winner}">${res.winner==='j'?'JíŒ€ ìŠ¹':'PíŒ€ ìŠ¹'}</div>`;
      } else {
        card.className='day-card upcoming';
        card.innerHTML=`<div class="day-date">${shortD(d)}</div><div class="day-scores"><span style="color:var(--muted);font-size:16px;font-weight:300">â€”</span></div><div class="day-badge tbd">ì˜ˆì •</div>`;
      }
      dDiv.appendChild(card);
    });
    block.appendChild(dDiv); wCont.appendChild(block);
  });
  document.getElementById('week-meta').textContent=`ì´ ${TOTAL_WD}í‰ì¼ Â· J ${totalJ}ìŠ¹ Â· P ${totalP}ìŠ¹`;

  /* â”€â”€ 4ìš”ì¸ í™•ë¥  ê³„ì‚° â”€â”€ */
  const { p: jProb, factors } = computeWinProbability(
    playedDates, dayResults, jWins, pWins, remaining, jTeam, pTeam
  );

  setTimeout(()=>{
    document.getElementById('j-prob').textContent=(jProb*100).toFixed(1)+'%';
    document.getElementById('p-prob').textContent=((1-jProb)*100).toFixed(1)+'%';
    document.getElementById('j-gauge').style.width=(jProb*100)+'%';
    document.getElementById('p-gauge').style.width=((1-jProb)*100)+'%';

    // ì•Œê³ ë¦¬ì¦˜ ìš”ì¸ UI
    if (factors) {
      const fmt = v => v.toFixed(1) + '%';
      const bar = (v, color) => `<div style="width:${Math.round(v*0.8)}px;height:6px;background:${color};border-radius:3px;display:inline-block;"></div>`;
      document.getElementById('algo-factors').innerHTML = `
        <div class="algo-factor">
          <div class="af-label">â‘  ì „ì²´ ì ìˆ˜ì°¨ ê¸°ë°˜ í™•ë¥ </div>
          <div class="af-val">í‰ê·  ë§ˆì§„ <b>${factors.avgMargin > 0 ? '+' : ''}${factors.avgMargin}</b> â†’ J <b style="color:var(--j)">${fmt(factors.p1)}</b> / P <b style="color:var(--p)">${fmt(100-factors.p1)}</b></div>
        </div>
        <div class="algo-factor">
          <div class="af-label">â‘¡ ìµœê·¼ 3ê²½ê¸° ëª¨ë©˜í…€ (ì§€ìˆ˜ê°€ì¤‘)</div>
          <div class="af-val">J ëª¨ë©˜í…€ <b style="color:var(--j)">${fmt(factors.p2)}</b> / P <b style="color:var(--p)">${fmt(100-factors.p2)}</b></div>
        </div>
        <div class="algo-factor">
          <div class="af-label">â‘¢ íŒ€ ì¼ê´€ì„± ì§€ìˆ˜ (ë¶„ì‚° ì—­ìˆ˜)</div>
          <div class="af-val">J ë¶„ì‚° <b>${factors.jVar}</b> / P ë¶„ì‚° <b>${factors.pVar}</b><br>â†’ J ì•ˆì •ì„± <b style="color:var(--j)">${fmt(factors.p3)}</b></div>
        </div>
        <div class="algo-factor">
          <div class="af-label">â‘£ ì´ê´€ë§¤ì¶œ ì—­ëŸ‰ ë¹„ìœ¨</div>
          <div class="af-val">J <b style="color:var(--j)">${factors.jTransfer > 0 ? factors.jTransfer.toLocaleString('ko-KR')+'ì›' : 'ë¯¸ì…ë ¥'}</b><br>P <b style="color:var(--p)">${factors.pTransfer > 0 ? factors.pTransfer.toLocaleString('ko-KR')+'ì›' : 'ë¯¸ì…ë ¥'}</b></div>
        </div>
      `;
      // ê°€ì¤‘ì¹˜ ë°˜ì˜ í…Œì´ë¸”
      const factorData = [
        { name: 'â‘  ì ìˆ˜ì°¨ ê¸°ë°˜ (35%)', j: factors.p1, p: 100-factors.p1 },
        { name: 'â‘¡ ìµœê·¼ ëª¨ë©˜í…€ (35%)', j: factors.p2, p: 100-factors.p2 },
        { name: 'â‘¢ ì¼ê´€ì„± ì§€ìˆ˜ (15%)', j: factors.p3, p: 100-factors.p3 },
        { name: 'â‘£ ì´ê´€ë§¤ì¶œ (15%)',    j: factors.p4, p: 100-factors.p4 },
      ];
      let detailHtml = '<div class="factor-detail">';
      factorData.forEach(f => {
        const maxBar = 120;
        detailHtml += `<div class="factor-row">
          <span class="factor-name">${f.name}</span>
          <div class="factor-bars">
            <span class="factor-num-j" style="color:var(--j)">${f.j.toFixed(1)}%</span>
            <div style="width:${Math.round(f.j/100*maxBar)}px;height:5px;background:var(--j);border-radius:3px;opacity:.8;"></div>
            <div style="width:2px"></div>
            <div style="width:${Math.round(f.p/100*maxBar)}px;height:5px;background:var(--p);border-radius:3px;opacity:.8;"></div>
            <span class="factor-num-p" style="color:var(--p)">${f.p.toFixed(1)}%</span>
          </div>
        </div>`;
      });
      detailHtml += '</div>';
      document.getElementById('factor-detail-container').innerHTML = detailHtml;
    } else {
      document.getElementById('algo-factors').innerHTML = '<div style="color:var(--muted);font-size:12px;grid-column:1/-1">ê²½ê¸° ë°ì´í„°ê°€ ìŒ“ì´ë©´ ìš”ì¸ë³„ ë¶„ì„ì´ í‘œì‹œë©ë‹ˆë‹¤.</div>';
    }
  },600);

  // Stakes
  const jLeading=jWins>=pWins;
  const winTeam=jLeading?jTeam:pTeam, loseTeam=jLeading?pTeam:jTeam;
  const wL=jLeading?'j':'p', lL=jLeading?'p':'j';
  const exemptList=winTeam.filter(m=>!m.isIntern).sort((a,b)=>b.transfer-a.transfer).slice(0,2);
  const eduList=loseTeam.filter(m=>!m.isIntern).sort((a,b)=>a.transfer-b.transfer).slice(0,2);
  const exemptNames=new Set(exemptList.map(m=>m.name));
  const eduNames=new Set(eduList.map(m=>m.name));

  const buildStakes=(list,id,team)=>{
    const body=document.getElementById(id); body.innerHTML='';
    if(!list.length){body.innerHTML='<div class="s-note">ì´ê´€ë§¤ì¶œ ë°ì´í„°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</div>';return;}
    list.forEach((m,i)=>{
      const row=document.createElement('div'); row.className='s-row';
      row.innerHTML=`<div class="s-rank">${i+1}</div><div class="s-name-st">${m.name}</div><span class="s-team-chip ${team}">${team.toUpperCase()}íŒ€</span><div class="s-transfer">${m.transfer>0?m.transfer.toLocaleString('ko-KR')+'ì›':'ë°ì´í„° ì—†ìŒ'}</div>`;
      body.appendChild(row);
    });
    const note=document.createElement('div'); note.className='s-note';
    note.innerHTML=`â€» í˜„ì¬ ê¸°ì¤€ Â· ì¸í„´ ì œì™¸ Â· ìµœì¢… í™•ì •ì€ í”„ë¡œëª¨ì…˜ ì¢…ë£Œ í›„<br>â€» ìŠ¹ë¦¬íŒ€ ê¸°ì¤€: í˜„ì¬ ë¦¬ë”©íŒ€(${jLeading?'J':'P'}íŒ€)`;
    body.appendChild(note);
  };
  buildStakes(exemptList,'exempt-body',wL);
  buildStakes(eduList,'edu-body',lL);

  // Individual Table
  const colSpan=5+playedDates.length;
  let html=`<thead><tr><th style="text-align:left">ì´ë¦„</th><th>íŒ€</th>`;
  playedDates.forEach(d=>html+=`<th>${shortD(d)}</th>`);
  html+=`<th>í‰ê· </th><th>ì´ê´€ë§¤ì¶œ</th><th>íŒ€æ¯”</th><th>ìƒëŒ€íŒ€æ¯”</th></tr></thead><tbody>`;

  const renderTeam=(team,myAvg,oppAvg,chip,exNames,eduNm)=>{
    html+=`<tr class="group-hd-row"><td colspan="${colSpan}" style="color:var(--${chip})">${chip.toUpperCase()}íŒ€ Â· íŒ€ ì¼í‰ê·  ${myAvg} &nbsp;|&nbsp; ë¹„êµ ê¸°ì¤€: ${chip==='j'?'P':'J'}íŒ€ ì¼í‰ê·  ${oppAvg}</td></tr>`;
    [...team].sort((a,b)=>b.avg-a.avg).forEach(m=>{
      const aT=m.avg>=myAvg, aO=m.avg>=oppAvg;
      const tC=aT?'var(--win)':'var(--lose)';
      const etag=exNames.has(m.name)?'<span class="tag-exempt">ë©´ì œí›„ë³´</span>':eduNm.has(m.name)?'<span class="tag-edu">êµìœ¡í›„ë³´</span>':'';
      const tDiff=fix2(m.avg-myAvg), oDiff=fix2(m.avg-oppAvg);
      html+=`<tr><td><span class="rank-dot" style="background:${tC}"></span>${m.name}${etag}</td><td><span class="team-chip-sm ${chip}">${chip.toUpperCase()}íŒ€</span></td>`;
      playedDates.forEach((_,i)=>{const v=m.scores[i];html+=`<td class="${v===null?'cell-null':v===0?'cell-z':v>=10?'cell-hi':''}">${v===null?'â€”':v}</td>`;});
      html+=`<td class="td-avg ${aT?'above-avg':'below-avg'}">${m.avg}</td>
        <td class="${m.transfer>0?'td-transfer':'td-transfer-zero'}">${m.transfer>0?m.transfer.toLocaleString('ko-KR')+'ì›':'-'}</td>
        <td style="color:${tC};font-size:11px;font-weight:700">${tDiff>=0?'+':''}${tDiff}</td>
        <td style="font-size:12px">${aO?'â­':'ğŸ’ª'}<span style="color:${aO?'var(--win)':'var(--lose)'};font-size:11px;font-weight:700;margin-left:2px">${oDiff>=0?'+':''}${oDiff}</span></td></tr>`;
    });
  };
  renderTeam(jTeam,jTeamAvg,pTeamAvg,'j',exemptNames,eduNames);
  renderTeam(pTeam,pTeamAvg,jTeamAvg,'p',exemptNames,eduNames);
  html+='</tbody>';
  document.getElementById('main-table').innerHTML=html;

  // ì—…ë°ì´íŠ¸ ë±ƒì§€
  const now2=new Date();
  document.getElementById('update-time').textContent=`${String(now2.getHours()).padStart(2,'0')}:${String(now2.getMinutes()).padStart(2,'0')} ì—…ë°ì´íŠ¸`;
  const badge=document.getElementById('update-badge');
  badge.style.display='flex';
  document.getElementById('loading').style.display='none';
  document.getElementById('dashboard').style.display='block';
}

/* â•â•â•â•â•â• FETCH & INIT â•â•â•â•â•â• */
async function loadData(){
  try{
    const res=await fetch(CSV_URL+'&t='+Date.now());
    if(!res.ok)throw new Error(`HTTP ${res.status}`);
    const text=await res.text();
    const rows=parseCSV(text);
    const data=parseData(rows);
    if(!data.jTeam.length||!data.pTeam.length)throw new Error('íŒ€ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì‹œíŠ¸ êµ¬ì¡°ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
    render(data);
  }catch(e){
    document.getElementById('loading').style.display='none';
    document.getElementById('error-msg').style.display='block';
    document.getElementById('error-detail').textContent=e.message;
  }
}

loadData();
setInterval(loadData, 5*60*1000);
</script>
</body>
</html>
